<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorteador de Times - Futsal/Society</title>
    <style>
        :root {
            --primary-color: #0d6efd;
            --secondary-color: #198754;
            --accent-color: #0dcaf0;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --dark-color: #212529;
            --light-color: #f8f9fa;
            --gray-color: #6c757d;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark-color);
            background-color: #f0f2f5;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            text-align: center;
            padding: 20px 0;
            margin-bottom: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h1 {
            margin: 0;
            font-size: 2.2rem;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-top: 10px;
        }

        .card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        select, textarea, input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #0b5ed7;
        }

        #playersList {
            margin-top: 30px;
        }

        .player-card {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .player-name {
            font-weight: 600;
            flex: 1;
        }

        .player-ratings {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .rating-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-end;
            gap: 8px;
        }

        .rating-option {
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .goalkeeper-checkbox {
            margin-left: 15px;
        }

        /* Estilos para nomear times */
        .team-naming-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .team-naming-card {
            background-color: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .team-naming-card h4 {
            margin: 0 0 15px 0;
            font-size: 1.3rem;
            color: var(--primary-color);
        }

        .team-naming-card input {
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
        }

        .team-preview {
            background-color: white;
            border-radius: 5px;
            padding: 10px;
            border: 1px solid #ccc;
        }

        .team-preview-header {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .team-preview-players {
            font-size: 14px;
            color: #666;
        }

        .naming-info {
            background-color: #e7f3ff;
            border-left: 4px solid var(--primary-color);
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .naming-info h4 {
            margin: 0 0 10px 0;
            color: var(--primary-color);
        }

        .naming-info p {
            margin: 5px 0;
            font-size: 14px;
        }

        #teamsResult {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .team-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border-top: 5px solid var(--primary-color);
        }

        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .team-name {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
        }

        .team-rating {
            background-color: var(--primary-color);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: 600;
        }

        .player-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .player-item:last-child {
            border-bottom: none;
        }

        .player-item-name {
            font-weight: 500;
        }

        .player-item-rating {
            background-color: #f0f2f5;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
        }

        .goalkeeper {
            color: var(--primary-color);
            font-weight: 700;
        }

        .goalkeeper::after {
            content: " (Goleiro)";
            font-size: 0.9em;
            color: var(--primary-color);
        }

        .makeshift-goalkeeper {
            color: var(--warning-color);
            font-weight: 700;
        }

        .fake-player {
            color: var(--danger-color);
            font-style: italic;
        }

        .step {
            display: none;
        }

        .step.active {
            display: block;
        }

        .steps-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }

        .step-dot {
            width: 15px;
            height: 15px;
            background-color: #ddd;
            border-radius: 50%;
            margin: 0 5px;
        }

        .step-dot.active {
            background-color: var(--primary-color);
        }

        .btn-container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .btn-back {
            background-color: var(--gray-color);
        }

        .btn-next {
            background-color: var(--secondary-color);
        }

        .custom-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .modal-header {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--danger-color);
            margin-bottom: 20px;
        }

        .modal-body {
            font-size: 1rem;
            line-height: 1.6;
            color: var(--dark-color);
            margin-bottom: 25px;
            text-align: left;
            white-space: pre-line;
        }

        .modal-footer {
            text-align: center;
        }

        .modal-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .modal-btn:hover {
            background-color: #0b5ed7;
        }

        #shareWhatsApp {
            background-color: #25D366 !important;
        }

        #shareWhatsApp:hover {
            background-color: #1da851 !important;
        }

        .rating-info {
            background-color: #e7f3ff;
            border-left: 4px solid var(--primary-color);
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .rating-info h4 {
            margin: 0 0 10px 0;
            color: var(--primary-color);
        }

        .rating-info p {
            margin: 5px 0;
            font-size: 14px;
        }

        .player-counter {
            text-align: right;
            margin-top: 5px;
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        /* Estilos para a tela de jogos */
        .game-header {
            background: linear-gradient(135deg, #198754, #20c997);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .match-info h3 {
            margin: 0 0 10px 0;
            font-size: 1.8rem;
        }

        .game-type-info {
            font-size: 14px;
            opacity: 0.9;
        }

        .scoreboard {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin: 20px 0;
        }

        .team-score {
            text-align: center;
        }

        .team-name-score {
            font-size: 16px;
            margin-bottom: 5px;
        }

        .score {
            font-size: 3rem;
            font-weight: bold;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 10px 20px;
            min-width: 80px;
        }

        .vs {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .timer-section {
            margin-top: 20px;
        }

        .timer {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 15px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 10px;
            display: inline-block;
            min-width: 120px;
        }

        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .timer-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background: rgba(255,255,255,0.2);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }

        .timer-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .teams-container {
            display: grid;
            grid-template-columns: 1fr 300px 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .team-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #dee2e6;
        }

        .team-panel h4 {
            margin: 0 0 15px 0;
            text-align: center;
            color: var(--primary-color);
            font-size: 1.2rem;
        }

        .players-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .player-item-game {
            background: white;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #dee2e6;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .player-goals {
            background: var(--primary-color);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            min-width: 20px;
            text-align: center;
        }

        .goal-panel {
            background: linear-gradient(135deg, #0d6efd, #6610f2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .goal-panel h4 {
            margin: 0 0 20px 0;
            font-size: 1.3rem;
        }

        .goal-controls {
            margin-bottom: 20px;
        }

        .goal-select {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .goal-type-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .goal-btn {
            padding: 12px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.2s;
        }

        .goal-btn:hover {
            transform: scale(1.05);
        }

        .goal-for {
            background: #28a745;
            color: white;
        }

        .goal-against {
            background: #dc3545;
            color: white;
        }

        .goal-history {
            text-align: left;
            margin-top: 20px;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 5px;
        }

        .goal-history h5 {
            margin: 0 0 10px 0;
            font-size: 1rem;
        }

        .goal-item {
            background: rgba(255,255,255,0.2);
            padding: 8px;
            border-radius: 3px;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .game-result {
            text-align: center;
            background: linear-gradient(135deg, #ffc107, #fd7e14);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .final-score {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 20px 0;
        }

        .final-result {
            font-size: 1.5rem;
            margin: 15px 0;
        }

        .match-summary {
            background: rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: left;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .team-card {
                margin-bottom: 20px;
            }
            
            .player-card {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .player-name {
                margin-bottom: 10px;
                font-size: 1rem;
            }
            
            .player-ratings {
                width: 100%;
                justify-content: space-between;
            }
            
            .rating-options {
                display: flex;
                gap: 10px;
            }
            
            button {
                width: 100%;
                margin-top: 5px;
            }
            
            .btn-container {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn-back, .btn-next {
                width: 100%;
            }

            #shareWhatsApp {
                margin-bottom: 10px;
            }
            
            .teams-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .goal-panel {
                order: -1;
            }
            
            .scoreboard {
                flex-direction: column;
                gap: 15px;
            }
            
            .score {
                font-size: 2rem;
            }
            
            .timer {
                font-size: 2rem;
            }

            .team-naming-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Sorteador de Times</h1>
            <div class="subtitle">Futsal & Society - Vers√£o Melhorada</div>
        </header>

        <div class="steps-indicator">
            <div class="step-dot active" data-step="1"></div>
            <div class="step-dot" data-step="2"></div>
            <div class="step-dot" data-step="3"></div>
            <div class="step-dot" data-step="4"></div>
            <div class="step-dot" data-step="5"></div>
        </div>

        <!-- Step 1: Configura√ß√µes -->
        <div class="step active" id="step1">
            <div class="card">
                <h2>Configura√ß√µes</h2>
                <div class="form-group">
                    <label for="gameType">Tipo de Jogo:</label>
                    <select id="gameType">
                        <option value="futsal">Futsal (5 jogadores por time)</option>
                        <option value="society">Society (Escolher n√∫mero de jogadores)</option>
                    </select>
                </div>

                <div class="form-group" id="societyPlayersContainer" style="display: none;">
                    <label for="societyPlayers">N√∫mero de jogadores por time:</label>
                    <select id="societyPlayers">
                        <option value="5">5 jogadores</option>
                        <option value="6">6 jogadores</option>
                        <option value="7">7 jogadores</option>
                        <option value="8">8 jogadores</option>
                        <option value="9">9 jogadores</option>
                        <option value="10">10 jogadores</option>
                        <option value="11">11 jogadores</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="numTeams">N√∫mero de times:</label>
                    <select id="numTeams">
                        <option value="2">2 times</option>
                        <option value="3">3 times</option>
                        <option value="4">4 times</option>
                        <option value="5">5 times</option>
                        <option value="6">6 times</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="playersInput">Lista de Jogadores (um por linha):</label>
                    <textarea id="playersInput" placeholder="Digite um nome por linha...
Exemplo:
Jo√£o
Pedro
Carlos
Rafael
Maria
Ana
Marcos
Lucas"></textarea>
                    <div id="playerCounter" class="player-counter">
                        0 jogadores listados
                    </div>
                </div>

                <div class="btn-container">
                    <div></div>
                    <button class="btn-next" id="goToStep2">Pr√≥ximo: Qualificar Jogadores</button>
                </div>
            </div>
        </div>

        <!-- Step 2: Qualificar jogadores -->
        <div class="step" id="step2">
            <div class="card">
                <h2>Qualificar Jogadores</h2>
                
                <div class="rating-info">
                    <h4>Sistema de Qualifica√ß√£o (1 a 5):</h4>
                    <p><strong>N√≠vel 1:</strong> Iniciante - T√©cnica b√°sica, ainda desenvolvendo habilidades</p>
                    <p><strong>N√≠vel 2:</strong> Intermedi√°rio - Boa t√©cnica, conhece o jogo</p>
                    <p><strong>N√≠vel 3:</strong> Avan√ßado - Muito boa t√©cnica, joga bem (PADR√ÉO)</p>
                    <p><strong>N√≠vel 4:</strong> Expert - Excelente t√©cnica, se destaca no grupo</p>
                    <p><strong>N√≠vel 5:</strong> Profissional - N√≠vel excepcional, faz a diferen√ßa</p>
                </div>

                <p>Atribua uma nota de 1 (menor) a 5 (maior) para cada jogador e marque se √© goleiro.</p>

                <div id="playersList"></div>

                <div class="btn-container">
                    <button class="btn-back" id="backToStep1">Voltar</button>
                    <button class="btn-next" id="goToStep3">Pr√≥ximo: Sortear Times</button>
                </div>
            </div>
        </div>

        <!-- Step 3: Nomear times -->
        <div class="step" id="step3">
            <div class="card">
                <h2>Nomear Times</h2>
                
                <div class="naming-info">
                    <h4>üè∑Ô∏è Personalize os Nomes dos Times</h4>
                    <p>Voc√™ pode dar nomes personalizados para cada time ou deixar em branco para usar nomes de cores padr√£o.</p>
                    <p><strong>Nomes padr√£o:</strong> AMARELO, AZUL, VERDE, VERMELHO, BRANCO, PRETO, etc.</p>
                </div>

                <div id="teamNamingGrid" class="team-naming-grid"></div>

                <div class="btn-container">
                    <button class="btn-back" id="backToStep2">Voltar</button>
                    <button class="btn-next" id="goToStep4">Pr√≥ximo: Ver Times Finais</button>
                </div>
            </div>
        </div>

        <!-- Step 4: Times sorteados -->
        <div class="step" id="step4">
            <div class="card">
                <h2>Times Sorteados</h2>
                <p>Os times foram sorteados de forma equilibrada com base nas qualifica√ß√µes.</p>

                <div id="teamsResult"></div>

                <div class="btn-container">
                    <button class="btn-back" id="backToStep3">Voltar</button>
                    <div style="display: flex; gap: 10px;">
                        <button id="shareWhatsApp" style="background-color: #25D366; display: flex; align-items: center; gap: 8px;">
                            <span>üì§</span> Compartilhar no WhatsApp
                        </button>
                        <button id="startGames" style="background-color: #198754;">Iniciar Jogos</button>
                        <button id="newDraw">Novo Sorteio</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 5: Administra√ß√£o de jogos -->
        <div class="step" id="step5">
            <div class="card">
                <h2 id="gameTitle">Administra√ß√£o de Jogos</h2>
                
                <!-- Configura√ß√£o do tipo de jogo -->
                <div id="gameConfigSection">
                    <div class="form-group">
                        <label for="gameMode">Tipo de Jogo:</label>
                        <select id="gameMode">
                            <option value="continuous">Jogo Cont√≠nuo (sem limite)</option>
                            <option value="timed">Tempo ou Gols (primeiro que atingir)</option>
                        </select>
                    </div>

                    <div id="timedGameOptions" style="display: none;">
                        <div class="form-group">
                            <label for="gameTime">Tempo Limite (minutos):</label>
                            <input type="number" id="gameTime" value="10" min="1" max="120">
                        </div>
                        <div class="form-group">
                            <label for="goalLimit">Limite de Gols:</label>
                            <input type="number" id="goalLimit" value="2" min="1" max="20">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="team1Select">Time 1:</label>
                        <select id="team1Select"></select>
                    </div>

                    <div class="form-group">
                        <label for="team2Select">Time 2:</label>
                        <select id="team2Select"></select>
                    </div>

                    <button id="startMatch" style="width: 100%; background-color: #198754; font-size: 18px; padding: 15px;">
                        üèÅ Iniciar Partida
                    </button>
                </div>

                <!-- Interface do jogo -->
                <div id="gamePlaySection" style="display: none;">
                    <div class="game-header">
                        <div class="match-info">
                            <h3 id="matchTitle">Time 1 vs Time 2</h3>
                            <div id="gameTypeInfo" class="game-type-info"></div>
                        </div>
                        
                        <div class="scoreboard">
                            <div class="team-score">
                                <div id="team1Name" class="team-name-score">Time 1</div>
                                <div id="team1Score" class="score">0</div>
                            </div>
                            <div class="vs">VS</div>
                            <div class="team-score">
                                <div id="team2Name" class="team-name-score">Time 2</div>
                                <div id="team2Score" class="score">0</div>
                            </div>
                        </div>

                        <div class="timer-section">
                            <div id="timer" class="timer">00:00</div>
                            <div class="timer-controls">
                                <button id="playPauseBtn" class="timer-btn">‚ñ∂Ô∏è Iniciar</button>
                                <button id="endGameBtn" class="timer-btn" style="background-color: #dc3545;">üèÅ Fim de Jogo</button>
                            </div>
                        </div>
                    </div>

                    <div class="teams-container">
                        <div class="team-panel">
                            <h4 id="team1PanelName">Time 1</h4>
                            <div id="team1Players" class="players-list"></div>
                        </div>
                        
                        <div class="goal-panel">
                            <h4>Marcar Gol</h4>
                            <div class="goal-controls">
                                <select id="goalScorer" class="goal-select">
                                    <option value="">Selecione o jogador</option>
                                </select>
                                <div class="goal-type-buttons">
                                    <button id="goalForBtn" class="goal-btn goal-for">‚öΩ Gol Normal</button>
                                    <button id="goalAgainstBtn" class="goal-btn goal-against">ü§¶ Gol Contra</button>
                                </div>
                            </div>
                            
                            <div id="goalHistory" class="goal-history">
                                <h5>Hist√≥rico de Gols:</h5>
                                <div id="goalsList"></div>
                            </div>
                        </div>

                        <div class="team-panel">
                            <h4 id="team2PanelName">Time 2</h4>
                            <div id="team2Players" class="players-list"></div>
                        </div>
                    </div>
                </div>

                <!-- Resultado do jogo -->
                <div id="gameResultSection" style="display: none;">
                    <div class="game-result">
                        <h3>üèÜ Resultado Final</h3>
                        <div id="finalScore" class="final-score"></div>
                        <div id="finalResult" class="final-result"></div>
                        <div id="matchSummary" class="match-summary"></div>
                    </div>
                    
                    <div class="btn-container">
                        <button id="nextMatchBtn" style="background-color: #198754;">Pr√≥ximo Jogo</button>
                        <button id="finishTournamentBtn" style="background-color: #0d6efd;">Finalizar Torneio</button>
                    </div>
                </div>

                <div class="btn-container" id="gameBackBtn" style="display: none;">
                    <button class="btn-back" id="backToStep4">Voltar aos Times</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modais -->
    <div id="customModal" class="custom-modal">
        <div class="modal-content">
            <div class="modal-header">‚ö†Ô∏è Aten√ß√£o</div>
            <div class="modal-body" id="modalMessage"></div>
            <div class="modal-footer">
                <button class="modal-btn" id="modalOkButton">OK</button>
            </div>
        </div>
    </div>

    <div id="backConfirmModal" class="custom-modal">
        <div class="modal-content">
            <div class="modal-header">ü§î Manter Qualifica√ß√µes?</div>
            <div class="modal-body">
                Voc√™ j√° atribuiu qualifica√ß√µes aos jogadores. O que deseja fazer?
            </div>
            <div class="modal-footer">
                <button class="modal-btn" id="keepRatingsBtn" style="background-color: #198754; margin-right: 10px;">
                    Manter Qualifica√ß√µes
                </button>
                <button class="modal-btn" id="clearRatingsBtn" style="background-color: #dc3545;">
                    Apagar Qualifica√ß√µes
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elementos DOM
            var gameTypeSelect = document.getElementById('gameType');
            var societyPlayersContainer = document.getElementById('societyPlayersContainer');
            var numTeamsSelect = document.getElementById('numTeams');
            var playersInput = document.getElementById('playersInput');
            var playersList = document.getElementById('playersList');
            var teamsResult = document.getElementById('teamsResult');
            var playerCounter = document.getElementById('playerCounter');
            var teamNamingGrid = document.getElementById('teamNamingGrid');
            
            // Bot√µes de navega√ß√£o
            var goToStep2 = document.getElementById('goToStep2');
            var goToStep3 = document.getElementById('goToStep3');
            var goToStep4 = document.getElementById('goToStep4');
            var backToStep1 = document.getElementById('backToStep1');
            var backToStep2 = document.getElementById('backToStep2');
            var backToStep3 = document.getElementById('backToStep3');
            var backToStep4 = document.getElementById('backToStep4');
            var newDraw = document.getElementById('newDraw');
            var shareWhatsApp = document.getElementById('shareWhatsApp');
            var startGames = document.getElementById('startGames');
            
            // Elementos das etapas
            var steps = document.querySelectorAll('.step');
            var stepDots = document.querySelectorAll('.step-dot');
            
            // Vari√°veis globais
            var currentTeams = [];
            var savedRatings = {};
            var teamNames = [];
            
            // Nomes de cores padr√£o
            var defaultTeamNames = [
                'AMARELO', 'AZUL', 'VERDE', 'VERMELHO', 'BRANCO', 'PRETO',
                'LARANJA', 'ROSA', 'ROXO', 'MARROM', 'CINZA', 'DOURADO'
            ];
            
            // Sistema de jogos
            var gameData = {
                teams: [],
                matches: [],
                currentMatch: null,
                timer: { minutes: 0, seconds: 0, interval: null, running: false },
                gameMode: 'continuous',
                timeLimit: 10,
                goalLimit: 2,
                tournamentStats: {}
            };

            // FUN√á√ïES UTILIT√ÅRIAS
            function updatePlayerCounter() {
                var playerNames = playersInput.value.split('\n').filter(function(name) {
                    return name.trim() !== '';
                });
                var count = playerNames.length;
                playerCounter.textContent = count + ' jogador' + (count !== 1 ? 'es' : '') + ' listado' + (count !== 1 ? 's' : '');
            }

            function shuffleArray(array) {
                for (var i = array.length - 1; i > 0; i--) {
                    var j = Math.floor(Math.random() * (i + 1));
                    var temp = array[i];
                    array[i] = array[j];
                    array[j] = temp;
                }
            }

            function showCustomAlert(message) {
                var modal = document.getElementById('customModal');
                var modalMessage = document.getElementById('modalMessage');
                modalMessage.textContent = message;
                modal.style.display = 'block';
            }

            function closeCustomModal() {
                var modal = document.getElementById('customModal');
                modal.style.display = 'none';
            }

            function showStep(stepNumber) {
                for (var i = 0; i < steps.length; i++) {
                    steps[i].classList.remove('active');
                }
                for (var i = 0; i < stepDots.length; i++) {
                    stepDots[i].classList.remove('active');
                }
                
                document.getElementById('step' + stepNumber).classList.add('active');
                document.querySelector('.step-dot[data-step="' + stepNumber + '"]').classList.add('active');
            }

            // SISTEMA DE QUALIFICA√á√ïES
            function saveCurrentRatings() {
                savedRatings = {};
                var playerCards = playersList.querySelectorAll('.player-card');
                
                for (var i = 0; i < playerCards.length; i++) {
                    var card = playerCards[i];
                    var name = card.querySelector('.player-name').textContent.trim();
                    var ratingInput = card.querySelector('input[name="rating_' + i + '"]:checked');
                    var isGoalkeeper = card.querySelector('input[name="goalkeeper_' + i + '"]').checked;
                    
                    if (ratingInput) {
                        savedRatings[name] = {
                            rating: parseInt(ratingInput.value),
                            isGoalkeeper: isGoalkeeper
                        };
                    }
                }
            }

            function restoreSavedRatings() {
                var playerCards = playersList.querySelectorAll('.player-card');
                
                for (var i = 0; i < playerCards.length; i++) {
                    var card = playerCards[i];
                    var name = card.querySelector('.player-name').textContent.trim();
                    
                    if (savedRatings[name]) {
                        var savedData = savedRatings[name];
                        
                        var ratingInput = card.querySelector('input[name="rating_' + i + '"][value="' + savedData.rating + '"]');
                        if (ratingInput) {
                            ratingInput.checked = true;
                        }
                        
                        var gkInput = card.querySelector('input[name="goalkeeper_' + i + '"]');
                        if (gkInput) {
                            gkInput.checked = savedData.isGoalkeeper;
                        }
                    }
                }
            }

            function clearSavedRatings() {
                savedRatings = {};
            }

            function hasAnyRatings() {
                return Object.keys(savedRatings).length > 0;
            }

            // VALIDA√á√ÉO
            function validatePlayerCountAtStep1(playerNames) {
                var gameType = gameTypeSelect.value;
                var playersPerTeam = gameType === 'futsal' ? 5 : parseInt(document.getElementById('societyPlayers').value);
                var numTimes = parseInt(numTeamsSelect.value);
                
                var totalJogadores = playerNames.length;
                var jogadoresNecessarios = numTimes * playersPerTeam;
                var faltandoJogadores = jogadoresNecessarios - totalJogadores;
                var excedente = totalJogadores - jogadoresNecessarios;
                var maxJogadoresFicticios = playersPerTeam - 1;
                
                if (excedente > 0) {
                    var mensagem = 'N√∫mero de jogadores inv√°lido!\n\n';
                    mensagem += 'Voc√™ tem ' + totalJogadores + ' jogadores para ' + numTimes + ' times de ' + playersPerTeam + ' jogadores cada.\n';
                    mensagem += 'Isso significa que ' + excedente + ' jogador' + (excedente > 1 ? 'es' : '') + ' ficar' + (excedente > 1 ? '√£o' : '√°') + ' de fora do sorteio.';
                    showCustomAlert(mensagem);
                    return false;
                }
                
                if (faltandoJogadores > maxJogadoresFicticios) {
                    var mensagem = 'N√∫mero de jogadores inv√°lido!\n\n';
                    mensagem += 'Voc√™ tem ' + totalJogadores + ' jogadores para ' + numTimes + ' times de ' + playersPerTeam + ' jogadores cada.\n';
                    mensagem += 'Faltam ' + faltandoJogadores + ' jogadores para completar os times.';
                    showCustomAlert(mensagem);
                    return false;
                }
                
                var jogadoresMinimos = numTimes;
                if (totalJogadores < jogadoresMinimos) {
                    var mensagem = 'N√∫mero de jogadores insuficiente!\n\n';
                    mensagem += 'Voc√™ precisa de pelo menos ' + jogadoresMinimos + ' jogadores (1 por time) para ' + numTimes + ' times.';
                    showCustomAlert(mensagem);
                    return false;
                }
                
                return true;
            }

            // SISTEMA DE NOMES DOS TIMES
            function setupTeamNaming(teams) {
                teamNamingGrid.innerHTML = '';
                teamNames = [];
                
                // Embaralhar nomes padr√£o
                var shuffledDefaultNames = defaultTeamNames.slice();
                shuffleArray(shuffledDefaultNames);
                
                for (var i = 0; i < teams.length; i++) {
                    var team = teams[i];
                    var defaultName = shuffledDefaultNames[i] || 'TIME ' + (i + 1);
                    
                    var teamCard = document.createElement('div');
                    teamCard.className = 'team-naming-card';
                    
                    var teamSum = 0;
                    for (var j = 0; j < team.length; j++) {
                        teamSum += team[j].rating;
                    }
                    var teamAvg = (teamSum / team.length).toFixed(1);
                    
                    var playersList = '';
                    var sortedTeam = team.slice().sort(function(a, b) {
                        if (a.isGoalkeeper && !b.isGoalkeeper) return -1;
                        if (!a.isGoalkeeper && b.isGoalkeeper) return 1;
                        return b.rating - a.rating;
                    });
                    
                    for (var j = 0; j < Math.min(3, sortedTeam.length); j++) {
                        var player = sortedTeam[j];
                        if (playersList !== '') playersList += ', ';
                        playersList += player.name;
                        if (player.isGoalkeeper) {
                            playersList += ' (GK)';
                        }
                    }
                    if (sortedTeam.length > 3) {
                        playersList += '...';
                    }
                    
                    teamCard.innerHTML = 
                        '<h4>Time ' + (i + 1) + '</h4>' +
                        '<input type="text" id="teamName_' + i + '" placeholder="' + defaultName + '" maxlength="20">' +
                        '<div class="team-preview">' +
                            '<div class="team-preview-header">M√©dia: ' + teamAvg + '</div>' +
                            '<div class="team-preview-players">' + playersList + '</div>' +
                        '</div>';
                    
                    teamNamingGrid.appendChild(teamCard);
                }
            }

            function getTeamNames() {
                var names = [];
                var shuffledDefaultNames = defaultTeamNames.slice();
                shuffleArray(shuffledDefaultNames);
                
                for (var i = 0; i < currentTeams.length; i++) {
                    var input = document.getElementById('teamName_' + i);
                    var customName = input.value.trim();
                    
                    if (customName !== '') {
                        names.push(customName.toUpperCase());
                    } else {
                        names.push(shuffledDefaultNames[i] || 'TIME ' + (i + 1));
                    }
                }
                
                return names;
            }

            // ALGORITMO DE SORTEIO
            function createBalancedTeamsImproved(players) {
                var gameType = gameTypeSelect.value;
                var playersPerTeam = gameType === 'futsal' ? 5 : parseInt(document.getElementById('societyPlayers').value);
                var numTimes = parseInt(numTeamsSelect.value);
                
                console.log('Iniciando algoritmo Round-Robin CORRETO');
                console.log('Jogadores por time: ' + playersPerTeam);
                console.log('Numero de times: ' + numTimes);
                
                var totalJogadores = players.length;
                var jogadoresNecessarios = numTimes * playersPerTeam;
                var faltandoJogadores = jogadoresNecessarios - totalJogadores;
                
                var goleiros = [];
                var jogadoresLinha = [];
                
                for (var i = 0; i < players.length; i++) {
                    if (players[i].isGoalkeeper) {
                        goleiros.push(players[i]);
                    } else {
                        jogadoresLinha.push(players[i]);
                    }
                }
                
                if (faltandoJogadores > 0) {
                    for (var i = 0; i < faltandoJogadores; i++) {
                        jogadoresLinha.push({
                            name: 'COMPLETE COM ALGUEM',
                            rating: 5,
                            isGoalkeeper: false,
                            isFake: true
                        });
                    }
                }
                
                shuffleArray(goleiros);
                shuffleArray(jogadoresLinha);
                
                var jogadoresPorNivel = { 1: [], 2: [], 3: [], 4: [], 5: [] };
                
                for (var i = 0; i < jogadoresLinha.length; i++) {
                    var jogador = jogadoresLinha[i];
                    jogadoresPorNivel[jogador.rating].push(jogador);
                }
                
                for (var nivel = 1; nivel <= 5; nivel++) {
                    shuffleArray(jogadoresPorNivel[nivel]);
                }
                
                var times = [];
                for (var i = 0; i < numTimes; i++) {
                    times.push({ id: i + 1, jogadores: [] });
                }
                
                function pegarProximoJogador(prioridades) {
                    for (var i = 0; i < prioridades.length; i++) {
                        var nivel = prioridades[i];
                        if (nivel === 'goleiro' && goleiros.length > 0) {
                            return goleiros.shift();
                        } else if (typeof nivel === 'number' && jogadoresPorNivel[nivel].length > 0) {
                            return jogadoresPorNivel[nivel].shift();
                        }
                    }
                    return null;
                }
                
                var rodada = 1;
                var todosTimesCompletos = false;
                
                while (!todosTimesCompletos) {
                    var prioridades = [];
                    
                    if (rodada === 1) {
                        prioridades = ['goleiro', 3, 2, 4, 1, 5];
                    } else if (rodada === 2) {
                        prioridades = [1, 2, 3, 4, 5];
                    } else if (rodada === 3) {
                        prioridades = [5, 4, 3, 2, 1];
                    } else if (rodada === 4) {
                        prioridades = [2, 3, 1, 4, 5];
                    } else if (rodada === 5) {
                        prioridades = [4, 3, 2, 5, 1];
                    } else {
                        var ciclo = ((rodada - 2) % 4) + 2;
                        if (ciclo === 2) prioridades = [1, 2, 3, 4, 5];
                        else if (ciclo === 3) prioridades = [5, 4, 3, 2, 1];
                        else if (ciclo === 4) prioridades = [2, 3, 1, 4, 5];
                        else if (ciclo === 5) prioridades = [4, 3, 2, 5, 1];
                    }
                    
                    var alguemRecebeuJogador = false;
                    
                    for (var timeIndex = 0; timeIndex < times.length; timeIndex++) {
                        var time = times[timeIndex];
                        
                        if (time.jogadores.length < playersPerTeam) {
                            var jogador = pegarProximoJogador(prioridades);
                            
                            if (jogador) {
                                if (rodada === 1 && !jogador.isGoalkeeper) {
                                    jogador = {
                                        name: jogador.name,
                                        rating: jogador.rating,
                                        isGoalkeeper: true,
                                        isMakeshift: true,
                                        isFake: jogador.isFake || false
                                    };
                                }
                                
                                time.jogadores.push(jogador);
                                alguemRecebeuJogador = true;
                            }
                        }
                    }
                    
                    todosTimesCompletos = true;
                    for (var i = 0; i < times.length; i++) {
                        if (times[i].jogadores.length < playersPerTeam) {
                            todosTimesCompletos = false;
                            break;
                        }
                    }
                    
                    if (!alguemRecebeuJogador && !todosTimesCompletos) {
                        break;
                    }
                    
                    rodada++;
                }
                
                for (var i = 0; i < times.length; i++) {
                    var time = times[i];
                    while (time.jogadores.length < playersPerTeam) {
                        time.jogadores.push({
                            name: 'COMPLETE COM ALGUEM',
                            rating: 3,
                            isGoalkeeper: false,
                            isFake: true
                        });
                    }
                }
                
                var result = [];
                for (var i = 0; i < times.length; i++) {
                    result.push(times[i].jogadores);
                }
                return result;
            }

            // EXIBI√á√ÉO DOS TIMES
            function displayTeams(teams) {
                teamsResult.innerHTML = '';
                teamNames = getTeamNames();
                
                for (var i = 0; i < teams.length; i++) {
                    var team = teams[i];
                    var teamCard = document.createElement('div');
                    teamCard.className = 'team-card';
                    
                    var teamName = teamNames[i] || 'Time ' + (i + 1);
                    var teamSum = 0;
                    for (var j = 0; j < team.length; j++) {
                        teamSum += team[j].rating;
                    }
                    var teamAvg = (teamSum / team.length).toFixed(1);
                    
                    var nivelCount = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };
                    for (var j = 0; j < team.length; j++) {
                        nivelCount[team[j].rating]++;
                    }
                    
                    var distribuicaoInfo = '';
                    for (var nivel = 1; nivel <= 5; nivel++) {
                        if (nivelCount[nivel] > 0) {
                            if (distribuicaoInfo !== '') distribuicaoInfo += ' | ';
                            distribuicaoInfo += 'N' + nivel + ':' + nivelCount[nivel];
                        }
                    }
                    
                    var teamContent = '<div class="team-header">';
                    teamContent += '<h3 class="team-name">' + teamName + '</h3>';
                    teamContent += '<div class="team-rating">M√©dia: ' + teamAvg + '</div>';
                    teamContent += '</div>';
                    teamContent += '<div style="text-align: center; font-size: 12px; color: #666; margin-bottom: 10px;">' + distribuicaoInfo + '</div>';
                    
                    team.sort(function(a, b) {
                        if (a.isGoalkeeper && !b.isGoalkeeper) return -1;
                        if (!a.isGoalkeeper && b.isGoalkeeper) return 1;
                        return b.rating - a.rating;
                    });
                    
                    teamContent += '<div class="team-players">';
                    
                    for (var j = 0; j < team.length; j++) {
                        var player = team[j];
                        var playerClass = '';
                        var playerDisplayName = player.name;
                        
                        if (player.isGoalkeeper) {
                            if (player.isMakeshift) {
                                playerClass = 'makeshift-goalkeeper';
                                playerDisplayName += ' (Goleiro Improvisado)';
                            } else {
                                playerClass = 'goalkeeper';
                            }
                        }
                        
                        if (player.isFake) {
                            playerClass = 'fake-player';
                        }
                        
                        teamContent += '<div class="player-item">';
                        teamContent += '<div class="player-item-name ' + playerClass + '">' + playerDisplayName + '</div>';
                        teamContent += '<div class="player-item-rating">' + player.rating + '</div>';
                        teamContent += '</div>';
                    }
                    
                    teamContent += '</div>';
                    teamCard.innerHTML = teamContent;
                    teamsResult.appendChild(teamCard);
                }
            }

            // WHATSAPP
            function shareTeamsOnWhatsApp(teams) {
                var gameType = gameTypeSelect.value;
                var playersPerTeam = gameType === 'futsal' ? 5 : parseInt(document.getElementById('societyPlayers').value);
                
                var message = 'TIMES SORTEADOS\n';
                message += gameType === 'futsal' ? 'Futsal' : 'Society';
                message += ' (' + playersPerTeam + ' jogadores)\n\n';
                
                for (var i = 0; i < teams.length; i++) {
                    var team = teams[i];
                    var teamAvg = 0;
                    for (var j = 0; j < team.length; j++) {
                        teamAvg += team[j].rating;
                    }
                    teamAvg = (teamAvg / team.length).toFixed(1);
                    
                    var teamName = teamNames[i] || 'Time ' + (i + 1);
                    message += teamName + ' (Media: ' + teamAvg + ')\n';
                    
                    var sortedTeam = team.slice().sort(function(a, b) {
                        if (a.isGoalkeeper && !b.isGoalkeeper) return -1;
                        if (!a.isGoalkeeper && b.isGoalkeeper) return 1;
                        return b.rating - a.rating;
                    });
                    
                    for (var j = 0; j < sortedTeam.length; j++) {
                        var player = sortedTeam[j];
                        var playerName = player.name;
                        var emoji = '';
                        
                        if (player.isGoalkeeper) {
                            emoji = 'GK';
                            if (player.isMakeshift) {
                                playerName += ' (Goleiro Improvisado)';
                            } else if (!player.isFake) {
                                playerName += ' (Goleiro)';
                            }
                        } else if (player.isFake) {
                            emoji = '?';
                        } else {
                            if (player.rating === 5) emoji = '5*';
                            else if (player.rating === 4) emoji = '4*';
                            else if (player.rating === 3) emoji = '3*';
                            else if (player.rating === 2) emoji = '2*';
                            else emoji = '1*';
                        }
                        
                        message += emoji + ' ' + playerName + ' (' + player.rating + ')\n';
                    }
                    
                    message += '\n';
                }
                
                message += 'Sorteio gerado automaticamente';
                
                var encodedMessage = encodeURIComponent(message);
                var whatsappUrl = 'https://api.whatsapp.com/send?text=' + encodedMessage;
                window.open(whatsappUrl, '_blank');
            }

            // EVENT LISTENERS
            playersInput.addEventListener('input', updatePlayerCounter);
            updatePlayerCounter();

            gameTypeSelect.addEventListener('change', function() {
                if (this.value === 'society') {
                    societyPlayersContainer.style.display = 'block';
                } else {
                    societyPlayersContainer.style.display = 'none';
                }
            });

            document.getElementById('modalOkButton').addEventListener('click', closeCustomModal);

            window.onclick = function(event) {
                var modal = document.getElementById('customModal');
                var backModal = document.getElementById('backConfirmModal');
                if (event.target === modal) {
                    closeCustomModal();
                }
                if (event.target === backModal) {
                    backModal.style.display = 'none';
                }
            };

            goToStep2.addEventListener('click', function() {
                var gameType = gameTypeSelect.value;
                var playersPerTeam = gameType === 'futsal' ? 5 : parseInt(document.getElementById('societyPlayers').value);
                
                var playerNames = playersInput.value.split('\n').filter(function(name) {
                    return name.trim() !== '';
                });
                
                if (playerNames.length === 0) {
                    showCustomAlert('Por favor, adicione pelo menos um jogador na lista!');
                    return;
                }
                
                if (playerNames.length < playersPerTeam) {
                    showCustomAlert('Por favor, adicione pelo menos ' + playersPerTeam + ' jogadores!');
                    return;
                }
                
                if (!validatePlayerCountAtStep1(playerNames)) {
                    return;
                }
                
                saveCurrentRatings();
                playersList.innerHTML = '';
                
                for (var i = 0; i < playerNames.length; i++) {
                    var name = playerNames[i];
                    var playerCard = document.createElement('div');
                    playerCard.className = 'player-card';
                    
                    var ratingOptions = '';
                    for (var j = 1; j <= 5; j++) {
                        var checked = j === 3 ? 'checked' : '';
                        ratingOptions += '<label class="rating-option">';
                        ratingOptions += '<input type="radio" name="rating_' + i + '" value="' + j + '" ' + checked + '>';
                        ratingOptions += j;
                        ratingOptions += '</label>';
                    }
                    
                    playerCard.innerHTML = '<div class="player-name">' + name.trim() + '</div>' +
                        '<div class="player-ratings">' +
                        '<div class="rating-options">' + ratingOptions + '</div>' +
                        '<div class="goalkeeper-checkbox">' +
                        '<label><input type="checkbox" name="goalkeeper_' + i + '"> Goleiro</label>' +
                        '</div></div>';
                    
                    playersList.appendChild(playerCard);
                }
                
                if (hasAnyRatings()) {
                    restoreSavedRatings();
                }
                
                showStep(2);
            });

            goToStep3.addEventListener('click', function() {
                var playerCards = playersList.querySelectorAll('.player-card');
                var players = [];
                
                for (var i = 0; i < playerCards.length; i++) {
                    var card = playerCards[i];
                    var name = card.querySelector('.player-name').textContent;
                    var ratingInput = card.querySelector('input[name="rating_' + i + '"]:checked');
                    var isGoalkeeper = card.querySelector('input[name="goalkeeper_' + i + '"]').checked;
                    
                    var rating = ratingInput ? parseInt(ratingInput.value) : 3;
                    
                    players.push({
                        name: name,
                        rating: rating,
                        isGoalkeeper: isGoalkeeper
                    });
                }
                
                var teams = createBalancedTeamsImproved(players);
                if (teams.length === 0) {
                    return;
                }
                
                currentTeams = teams;
                setupTeamNaming(teams);
                showStep(3);
            });

            goToStep4.addEventListener('click', function() {
                teamNames = getTeamNames();
                displayTeams(currentTeams);
                showStep(4);
            });

            backToStep1.addEventListener('click', function() {
                if (playersList.children.length > 0) {
                    saveCurrentRatings();
                    
                    if (hasAnyRatings()) {
                        var backModal = document.getElementById('backConfirmModal');
                        backModal.style.display = 'block';
                        return;
                    }
                }
                
                showStep(1);
            });
            
            document.getElementById('keepRatingsBtn').addEventListener('click', function() {
                document.getElementById('backConfirmModal').style.display = 'none';
                showStep(1);
            });
            
            document.getElementById('clearRatingsBtn').addEventListener('click', function() {
                clearSavedRatings();
                document.getElementById('backConfirmModal').style.display = 'none';
                showStep(1);
            });
            
            backToStep2.addEventListener('click', function() {
                showStep(2);
            });
            
            backToStep3.addEventListener('click', function() {
                showStep(3);
            });
            
            backToStep4.addEventListener('click', function() {
                showStep(4);
            });
            
            newDraw.addEventListener('click', function() {
                playersInput.value = '';
                updatePlayerCounter();
                teamNames = [];
                showStep(1);
            });

            shareWhatsApp.addEventListener('click', function() {
                if (currentTeams.length > 0) {
                    shareTeamsOnWhatsApp(currentTeams);
                }
            });

            startGames.addEventListener('click', function() {
                if (currentTeams.length < 2) {
                    showCustomAlert('√â necess√°rio ter pelo menos 2 times para iniciar os jogos!');
                    return;
                }
                initializeGameSystem();
                showStep(5);
            });

            // SISTEMA DE JOGOS
            function initializeGameSystem() {
                gameData.teams = currentTeams.map(function(team, index) {
                    return {
                        id: index + 1,
                        name: teamNames[index] || 'Time ' + (index + 1),
                        players: team,
                        points: 0,
                        goals: 0,
                        goalsAgainst: 0,
                        matches: 0
                    };
                });
                
                populateTeamSelects();
                resetGameInterface();
            }
            
            function populateTeamSelects() {
                var team1Select = document.getElementById('team1Select');
                var team2Select = document.getElementById('team2Select');
                
                team1Select.innerHTML = '';
                team2Select.innerHTML = '';
                
                gameData.teams.forEach(function(team) {
                    var option1 = document.createElement('option');
                    option1.value = team.id;
                    option1.textContent = team.name;
                    team1Select.appendChild(option1);
                    
                    var option2 = document.createElement('option');
                    option2.value = team.id;
                    option2.textContent = team.name;
                    team2Select.appendChild(option2);
                });
                
                if (gameData.teams.length > 1) {
                    team2Select.value = gameData.teams[1].id;
                }
            }
            
            function resetGameInterface() {
                document.getElementById('gameConfigSection').style.display = 'block';
                document.getElementById('gamePlaySection').style.display = 'none';
                document.getElementById('gameResultSection').style.display = 'none';
                document.getElementById('gameBackBtn').style.display = 'none';
                
                resetTimer();
                
                document.getElementById('team1Score').textContent = '0';
                document.getElementById('team2Score').textContent = '0';
                document.getElementById('goalsList').innerHTML = '';
            }
            
            document.getElementById('gameMode').addEventListener('change', function() {
                var timedOptions = document.getElementById('timedGameOptions');
                if (this.value === 'timed') {
                    timedOptions.style.display = 'block';
                } else {
                    timedOptions.style.display = 'none';
                }
            });
            
            document.getElementById('startMatch').addEventListener('click', function() {
                var team1Id = parseInt(document.getElementById('team1Select').value);
                var team2Id = parseInt(document.getElementById('team2Select').value);
                
                if (team1Id === team2Id) {
                    showCustomAlert('Selecione times diferentes para a partida!');
                    return;
                }
                
                startMatch(team1Id, team2Id);
            });
            
            function startMatch(team1Id, team2Id) {
                var team1 = gameData.teams.find(function(t) { return t.id === team1Id; });
                var team2 = gameData.teams.find(function(t) { return t.id === team2Id; });
                
                gameData.gameMode = document.getElementById('gameMode').value;
                gameData.timeLimit = parseInt(document.getElementById('gameTime').value);
                gameData.goalLimit = parseInt(document.getElementById('goalLimit').value);
                
                gameData.currentMatch = {
                    team1: team1,
                    team2: team2,
                    score1: 0,
                    score2: 0,
                    goals: [],
                    startTime: new Date(),
                    endTime: null,
                    winner: null
                };
                
                setupMatchInterface();
                
                document.getElementById('gameConfigSection').style.display = 'none';
                document.getElementById('gamePlaySection').style.display = 'block';
                document.getElementById('gameBackBtn').style.display = 'block';
            }
            
            function setupMatchInterface() {
                var match = gameData.currentMatch;
                
                document.getElementById('matchTitle').textContent = match.team1.name + ' vs ' + match.team2.name;
                document.getElementById('team1Name').textContent = match.team1.name;
                document.getElementById('team2Name').textContent = match.team2.name;
                document.getElementById('team1PanelName').textContent = match.team1.name;
                document.getElementById('team2PanelName').textContent = match.team2.name;
                
                var gameTypeInfo = document.getElementById('gameTypeInfo');
                if (gameData.gameMode === 'timed') {
                    gameTypeInfo.textContent = 'Primeiro a ' + gameData.goalLimit + ' gols ou ' + gameData.timeLimit + ' minutos';
                } else {
                    gameTypeInfo.textContent = 'Jogo cont√≠nuo - sem limite de tempo';
                }
                
                populatePlayersList();
                populateGoalScorer();
                resetTimer();
            }
            
            function populatePlayersList() {
                var team1Players = document.getElementById('team1Players');
                var team2Players = document.getElementById('team2Players');
                
                team1Players.innerHTML = '';
                team2Players.innerHTML = '';
                
                gameData.currentMatch.team1.players.forEach(function(player) {
                    var playerDiv = document.createElement('div');
                    playerDiv.className = 'player-item-game';
                    playerDiv.innerHTML = '<span>' + player.name + '</span><span class="player-goals" id="goals-' + player.name.replace(/\s+/g, '') + '">0</span>';
                    team1Players.appendChild(playerDiv);
                });
                
                gameData.currentMatch.team2.players.forEach(function(player) {
                    var playerDiv = document.createElement('div');
                    playerDiv.className = 'player-item-game';
                    playerDiv.innerHTML = '<span>' + player.name + '</span><span class="player-goals" id="goals-' + player.name.replace(/\s+/g, '') + '">0</span>';
                    team2Players.appendChild(playerDiv);
                });
            }
            
            function populateGoalScorer() {
                var goalScorer = document.getElementById('goalScorer');
                goalScorer.innerHTML = '<option value="">Selecione o jogador</option>';
                
                var allPlayers = gameData.currentMatch.team1.players.concat(gameData.currentMatch.team2.players);
                
                allPlayers.forEach(function(player) {
                    var option = document.createElement('option');
                    option.value = player.name;
                    option.textContent = player.name;
                    goalScorer.appendChild(option);
                });
            }
            
            function resetTimer() {
                gameData.timer.minutes = 0;
                gameData.timer.seconds = 0;
                gameData.timer.running = false;
                
                if (gameData.timer.interval) {
                    clearInterval(gameData.timer.interval);
                    gameData.timer.interval = null;
                }
                
                updateTimerDisplay();
                document.getElementById('playPauseBtn').textContent = '‚ñ∂Ô∏è Iniciar';
            }
            
            function updateTimerDisplay() {
                var minutes = String(gameData.timer.minutes).padStart(2, '0');
                var seconds = String(gameData.timer.seconds).padStart(2, '0');
                document.getElementById('timer').textContent = minutes + ':' + seconds;
            }
            
            function startTimer() {
                if (gameData.timer.running) return;
                
                gameData.timer.running = true;
                document.getElementById('playPauseBtn').textContent = '‚è∏Ô∏è Pausar';
                
                gameData.timer.interval = setInterval(function() {
                    gameData.timer.seconds++;
                    
                    if (gameData.timer.seconds >= 60) {
                        gameData.timer.seconds = 0;
                        gameData.timer.minutes++;
                    }
                    
                    updateTimerDisplay();
                    
                    if (gameData.gameMode === 'timed' && gameData.timer.minutes >= gameData.timeLimit) {
                        endMatch('time');
                    }
                }, 1000);
            }
            
            function pauseTimer() {
                if (!gameData.timer.running) return;
                
                gameData.timer.running = false;
                document.getElementById('playPauseBtn').textContent = '‚ñ∂Ô∏è Continuar';
                
                if (gameData.timer.interval) {
                    clearInterval(gameData.timer.interval);
                    gameData.timer.interval = null;
                }
            }
            
            document.getElementById('playPauseBtn').addEventListener('click', function() {
                if (gameData.timer.running) {
                    pauseTimer();
                } else {
                    startTimer();
                }
            });
            
            document.getElementById('endGameBtn').addEventListener('click', function() {
                endMatch('manual');
            });
            
            document.getElementById('goalForBtn').addEventListener('click', function() {
                var player = document.getElementById('goalScorer').value;
                if (!player) {
                    showCustomAlert('Selecione um jogador para marcar o gol!');
                    return;
                }
                addGoal(player, 'normal');
            });
            
            document.getElementById('goalAgainstBtn').addEventListener('click', function() {
                var player = document.getElementById('goalScorer').value;
                if (!player) {
                    showCustomAlert('Selecione um jogador para o gol contra!');
                    return;
                }
                addGoal(player, 'own');
            });
            
            function addGoal(playerName, type) {
                var match = gameData.currentMatch;
                var isTeam1Player = match.team1.players.some(function(p) { return p.name === playerName; });
                
                var goal = {
                    player: playerName,
                    type: type,
                    time: gameData.timer.minutes + ':' + String(gameData.timer.seconds).padStart(2, '0'),
                    team: isTeam1Player ? 1 : 2
                };
                
                match.goals.push(goal);
                
                if (type === 'normal') {
                    if (isTeam1Player) {
                        match.score1++;
                    } else {
                        match.score2++;
                    }
                } else {
                    if (isTeam1Player) {
                        match.score2++;
                    } else {
                        match.score1++;
                    }
                }
                
                updateScoreboard();
                updateGoalHistory();
                updatePlayerGoals(playerName);
                
                document.getElementById('goalScorer').value = '';
                
                if (gameData.gameMode === 'timed' && 
                    (match.score1 >= gameData.goalLimit || match.score2 >= gameData.goalLimit)) {
                    endMatch('goals');
                }
            }
            
            function updateScoreboard() {
                var match = gameData.currentMatch;
                document.getElementById('team1Score').textContent = match.score1;
                document.getElementById('team2Score').textContent = match.score2;
            }
            
            function updateGoalHistory() {
                var goalsList = document.getElementById('goalsList');
                var match = gameData.currentMatch;
                
                goalsList.innerHTML = '';
                
                match.goals.forEach(function(goal) {
                    var goalDiv = document.createElement('div');
                    goalDiv.className = 'goal-item';
                    
                    var goalText = goal.time + ' - ' + goal.player;
                    if (goal.type === 'own') {
                        goalText += ' (Gol Contra)';
                    }
                    
                    goalDiv.textContent = goalText;
                    goalsList.appendChild(goalDiv);
                });
            }
            
            function updatePlayerGoals(playerName) {
                var playerGoalSpan = document.getElementById('goals-' + playerName.replace(/\s+/g, ''));
                if (playerGoalSpan) {
                    var currentGoals = parseInt(playerGoalSpan.textContent) || 0;
                    playerGoalSpan.textContent = currentGoals + 1;
                }
            }
            
            function endMatch(reason) {
                pauseTimer();
                
                var match = gameData.currentMatch;
                match.endTime = new Date();
                
                var winner = null;
                var points1 = 0, points2 = 0;
                
                if (match.score1 > match.score2) {
                    winner = match.team1;
                    points1 = 3;
                    points2 = 0;
                } else if (match.score2 > match.score1) {
                    winner = match.team2;
                    points1 = 0;
                    points2 = 3;
                } else {
                    points1 = 1;
                    points2 = 1;
                }
                
                match.winner = winner;
                
                match.team1.points += points1;
                match.team2.points += points2;
                match.team1.goals += match.score1;
                match.team2.goals += match.score2;
                match.team1.goalsAgainst += match.score2;
                match.team2.goalsAgainst += match.score1;
                match.team1.matches++;
                match.team2.matches++;
                
                updateTournamentStats();
                gameData.matches.push(match);
                
                showMatchResult(reason);
            }
            
            function updateTournamentStats() {
                var match = gameData.currentMatch;
                
                if (!gameData.tournamentStats.playerGoals) {
                    gameData.tournamentStats.playerGoals = {};
                }
                
                match.goals.forEach(function(goal) {
                    if (!gameData.tournamentStats.playerGoals[goal.player]) {
                        gameData.tournamentStats.playerGoals[goal.player] = 0;
                    }
                    gameData.tournamentStats.playerGoals[goal.player]++;
                });
            }
            
            function showMatchResult(reason) {
                var match = gameData.currentMatch;
                
                document.getElementById('gamePlaySection').style.display = 'none';
                document.getElementById('gameResultSection').style.display = 'block';
                
                var finalScore = document.getElementById('finalScore');
                finalScore.textContent = match.team1.name + ' ' + match.score1 + ' x ' + match.score2 + ' ' + match.team2.name;
                
                var finalResult = document.getElementById('finalResult');
                if (match.winner) {
                    finalResult.textContent = 'üèÜ Vencedor: ' + match.winner.name + '!';
                    finalResult.style.color = '#28a745';
                } else {
                    finalResult.textContent = 'ü§ù Empate!';
                    finalResult.style.color = '#ffc107';
                }
                
                var matchSummary = document.getElementById('matchSummary');
                var duration = gameData.timer.minutes + ':' + String(gameData.timer.seconds).padStart(2, '0');
                
                var summary = '<h5>üìä Resumo da Partida</h5>';
                summary += '<p><strong>Dura√ß√£o:</strong> ' + duration + '</p>';
                summary += '<p><strong>Raz√£o do fim:</strong> ';
                
                if (reason === 'time') {
                    summary += 'Tempo esgotado</p>';
                } else if (reason === 'goals') {
                    summary += 'Limite de gols atingido</p>';
                } else {
                    summary += 'Finalizada manualmente</p>';
                }
                
                summary += '<p><strong>Pontos atribu√≠dos:</strong></p>';
                summary += '<ul>';
                summary += '<li>' + match.team1.name + ': ' + (match.score1 > match.score2 ? 3 : match.score1 === match.score2 ? 1 : 0) + ' pontos</li>';
                summary += '<li>' + match.team2.name + ': ' + (match.score2 > match.score1 ? 3 : match.score1 === match.score2 ? 1 : 0) + ' pontos</li>';
                summary += '</ul>';
                
                if (match.goals.length > 0) {
                    summary += '<p><strong>Gols marcados:</strong></p>';
                    summary += '<ul>';
                    match.goals.forEach(function(goal) {
                        summary += '<li>' + goal.time + ' - ' + goal.player;
                        if (goal.type === 'own') summary += ' (Gol Contra)';
                        summary += '</li>';
                    });
                    summary += '</ul>';
                }
                
                matchSummary.innerHTML = summary;
            }
            
            document.getElementById('nextMatchBtn').addEventListener('click', function() {
                resetGameInterface();
            });
            
            document.getElementById('finishTournamentBtn').addEventListener('click', function() {
                generateTournamentReport();
            });
            
            function generateTournamentReport() {
                var report = 'üèÜ RELAT√ìRIO DO TORNEIO üèÜ\n\n';
                
                var sortedTeams = gameData.teams.slice().sort(function(a, b) {
                    if (b.points !== a.points) return b.points - a.points;
                    var saldoA = a.goals - a.goalsAgainst;
                    var saldoB = b.goals - b.goalsAgainst;
                    if (saldoB !== saldoA) return saldoB - saldoA;
                    return b.goals - a.goals;
                });
                
                report += 'üìä CLASSIFICA√á√ÉO FINAL:\n';
                sortedTeams.forEach(function(team, index) {
                    var saldo = team.goals - team.goalsAgainst;
                    report += (index + 1) + '¬∫ ' + team.name + ' - ' + team.points + ' pts';
                    report += ' (J:' + team.matches + ' SG:' + saldo + ')\n';
                });
                
                if (gameData.tournamentStats.playerGoals) {
                    var topScorers = Object.keys(gameData.tournamentStats.playerGoals)
                        .map(function(player) {
                            return { 
                                name: player, 
                                goals: gameData.tournamentStats.playerGoals[player] 
                            };
                        })
                        .sort(function(a, b) { return b.goals - a.goals; });
                    
                    report += '\n‚öΩ ARTILHEIROS:\n';
                    topScorers.slice(0, 5).forEach(function(scorer, index) {
                        report += (index + 1) + '¬∫ ' + scorer.name + ' - ' + scorer.goals + ' gol';
                        if (scorer.goals !== 1) report += 's';
                        report += '\n';
                    });
                }
                
                if (gameData.matches.length > 0) {
                    report += '\nüìã HIST√ìRICO DE JOGOS:\n';
                    gameData.matches.forEach(function(match, index) {
                        report += (index + 1) + '. ' + match.team1.name + ' ' + match.score1;
                        report += ' x ' + match.score2 + ' ' + match.team2.name;
                        if (match.winner) {
                            report += ' (Venceu: ' + match.winner.name + ')';
                        } else {
                            report += ' (Empate)';
                        }
                        report += '\n';
                    });
                }
                
                report += '\nüé≤ Sorteio gerado pelo sistema autom√°tico';
                
                var encodedMessage = encodeURIComponent(report);
                var whatsappUrl = 'https://api.whatsapp.com/send?text=' + encodedMessage;
                window.open(whatsappUrl, '_blank');
                
                setTimeout(function() {
                    playersInput.value = '';
                    updatePlayerCounter();
                    currentTeams = [];
                    teamNames = [];
                    gameData = {
                        teams: [],
                        matches: [],
                        currentMatch: null,
                        timer: { minutes: 0, seconds: 0, interval: null, running: false },
                        gameMode: 'continuous',
                        timeLimit: 10,
                        goalLimit: 2,
                        tournamentStats: {}
                    };
                    showStep(1);
                }, 2000);
            }
        });
    </script>
</body>
</html>
